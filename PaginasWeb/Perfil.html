<div class="go-to-call">
	<button id="idLlamada" type="button" data-toggle="modal" data-target="#exampleModalCenter" class="btn btn-callme-primary">
		<a href="#" title="Ayuda">
			<i class="glyphicon glyphicon-earphone"></i>
			<span class="sr-only">Llámanos</span>
		</a>
	</button>
</div>
<div id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" class="modal fade">
	<div role="document" class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h3 id="exampleModalCenterTitle" class="modal-title">¿Necesitas ayuda?</h3>
				<button id="idLlamada" type="button" data-dismiss="modal" aria-label="Close" class="close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body">
				{% include 'Llamada telefonica' %}
			</div>
		</div>
	</div>
</div>
  
<script language="javascript">
  $(document).ready(function () {
    $(".breadcrumb").remove();
    $("div.page-header").remove();
    $("div.xrm-editable-html.xrm-attribute.no-value.page-copy").remove();
    FormularioRepresentante.EventosOnload();
  });

  if (window.jQuery) {
    (function ($) {
      if (typeof webFormClientValidate != "undefined") {
        var originalValidationFunction = webFormClientValidate;
        if (
          originalValidationFunction &&
          typeof originalValidationFunction == "function"
        ) {
          webFormClientValidate = function () {
            valorPoliticaPrivacidad = $("#crcd6_politicaprivacidad")
              .find(":radio:checked")
              .first()
              .attr("value");

            if (valorPoliticaPrivacidad) {
              return true;
            } else {
              return false;
            }
          };
        }
      }
    })(window.jQuery);
  }

  const FormularioRepresentante = {
    EventosOnload: function () {
      FormularioRepresentante.CambiarEtiquetaBoton();
      FormularioRepresentante.OcultarColumnaEstado();
      FormularioRepresentante.DeshabilitarBoton();
      FormularioRepresentante.DeshabilitarCampo('#emailaddress1');
      FormularioRepresentante.MensajeAyuda();
      FormularioRepresentante.RemoverSeccion();
      FormularioRepresentante.AsignarNombreCompletoCesionDatos();
      FormularioRepresentante.ConvertirPoliticasPrivacidadAEnlace();
      FormularioRepresentante.EventosOnClick();
      FormularioRepresentante.ModificarLookups();
      $(window).resize(function() {
        FormularioRepresentante.ModificarLookups();
      });
    },
    ModificarLookups: function(){
      $('button.btn.btn-default.launchentitylookup').css("padding-left",$("#crcd6_paisid_name").width());
      $('button.btn.btn-default.clearlookupfield').css("z-index",1);
      $('button.btn.btn-default.launchentitylookup').attr('data-original-title', '');
    },
    CambiarEtiquetaBoton: function(){
        $("#ContentContainer_MainContent_MainContent_ContentBottom_SubmitButton").attr('value', 'Siguiente');
    },
    CambiarEtiquetaBoton: function(){
        $("#ContentContainer_MainContent_MainContent_ContentBottom_SubmitButton").attr('value', 'Siguiente');
    },
    OcultarColumnaEstado: function(){
        setTimeout(function(){ 
            $('#crcd6_paisid_lookupmodal table tr th:nth-child(3),#crcd6_paisid_lookupmodal table tr td:nth-child(3)').hide();
            $('#crcd6_nacionalidad_lookupmodal table tr th:nth-child(3),#crcd6_nacionalidad_lookupmodal table tr td:nth-child(3)').hide();
        }, 6000);
    },
    RemoverSeccion: function () {
        $('.tab clearfix').remove();
        $('#NextButton').remove();
    },
    EventosOnClick: function () {
      $("#crcd6_politicaprivacidad").change(function () {
        FormularioRepresentante.DatosCorrectos();
      }),
        $("#telephone1").change(function () {
          FormularioRepresentante.EliminarDivError("#errorTelefono");
          FormularioRepresentante.DatosCorrectos();
        }),
        $("#crcd6_nif").change(function () {
          FormularioRepresentante.EliminarDivError("#errorDNI");
          FormularioRepresentante.DatosCorrectos();
        }),
        $("#crcd6_autorizarcesiondatos").change(function () {
          FormularioRepresentante.DatosCorrectos();
        });
    },
    ValidacionPoliticaPrivacidad: function () {
      politicaValida = false;
      valorPoliticaPrivacidad = $("#crcd6_politicaprivacidad")
        .find(":radio:checked")
        .first()
        .attr("value");

      if (valorPoliticaPrivacidad === "0") {
        politicaValida = false;
      } else {
        politicaValida = true;
      }
      return politicaValida;
    },
    ValidacionCesionDatos: function () {
      cesionValida = false;
      valorCesionDatos = $("#crcd6_autorizarcesiondatos")
        .find(":radio:checked")
        .first()
        .attr("value");

      if (valorCesionDatos === "0") {
        cesionValida = false;
      } else {
        cesionValida = true;
      }
      return cesionValida;
    },
    HabilitarBoton: function () {
      $(':input[id="ContentContainer_MainContent_MainContent_ContentBottom_SubmitButton"]').prop("disabled", false);
    },
    DeshabilitarBoton: function () {
      $(':input[id="ContentContainer_MainContent_MainContent_ContentBottom_SubmitButton"]').prop("disabled", true);
    },
    DeshabilitarCampo: function(id){
        $(id).prop("disabled", true);
    },
    MensajeAyuda: function () {
      $('#EntityFormControl').after('<div id="mensajeAyuda" class="alert alert-info" role="alert">Necesitamos que completes tus datos como representante legal o apoderado de la empresa. Recuerda leer y aceptar las políticas de privacidad para continuar con el proceso.</div>'); 
    },
    ConvertirPoliticasPrivacidadAEnlace: function () {
      $("#crcd6_politicaprivacidad_label").wrapInner(
        '<a href="~/declaracion-privacidad" target="_blank"></a>'
      );
    },
    AsignarNombreCompletoCesionDatos: function () {
      $("#crcd6_autorizarcesiondatos_label").text("Soy profesional liberal/autónomo y autorizo a PwC a la cesión de mis datos personales a Banco de Sabadell, S.A. con CIF A08000143 con el fin de que pueda realizar acciones comerciales de productos o servicios financieros vinculados a la obtención de las subvenciones de fondos públicos.").val();
      $("#crcd6_politicaprivacidad_label").text("He leído la política de privacidad y acepto las condiciones de uso, confidencialidad y protección de datos");
      $("#crcd6_autorizarcesindatosautonomo_label").text("Soy profesional liberal/autónomo y autorizo a PwC la cesión de mis datos personales a Banco de Sabadell con CIF A08000143, con el fin de que el Banco pueda realizar un seguimiento de mi solicitud realizada a través de este portal en relación con las subvenciones de fondos públicos.").val();
    },
    ValidacionTelefono: function () {
      let telefonoValido = false;
      const regex = "^[769]{1}[0-9]{8}$";
      let numeroTelefono = $("#telephone1").val();
      let numeroValido = numeroTelefono.match(regex);

      if (numeroValido) {
        telefonoValido = true;
      } else {
        telefonoValido = false;
        FormularioRepresentante.MensajeErrorTelefono();
      }
      return telefonoValido;
    },
    ValidarDNI: function () {
      dniValido = false;
      var validChars = "TRWAGMYFPDXBNJZSQVHLCKET";
      var nifRexp = /^[0-9]{8}[TRWAGMYFPDXBNJZSQVHLCKET]$/i;
      var nieRexp = /^[XYZ][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKET]$/i;
      var dniComprobar = $("#crcd6_nif").val();
      var str = dniComprobar.toString().toUpperCase();

      if (!nifRexp.test(str) && !nieRexp.test(str)) {
        FormularioRepresentante.MensajeErrorDNI();
        return false;
      }

      var nie = str
        .replace(/^[X]/, "0")
        .replace(/^[Y]/, "1")
        .replace(/^[Z]/, "2");

      var letter = str.substr(-1);
      var charIndex = parseInt(nie.substr(0, 8)) % 23;

      if (validChars.charAt(charIndex) === letter) {
        dniValido = true;
        return true;
      } else {
        dniValido = false;
        FormularioRepresentante.MensajeErrorDNI();
        return false;
      }
    },
    DatosCorrectos: function () {
      let politicaValida = FormularioRepresentante.ValidacionPoliticaPrivacidad();
      let cesionValida = FormularioRepresentante.ValidacionCesionDatos();

      let telefonoValido = false;
      let dniValido = false;  
      
      let telefonoNumero = $("#telephone1").val();
      let dniNumero = $("#crcd6_nif").val();
      //Control de telefono sin que aparezca el error de DNI
      if (telefonoNumero !== ""){
        telefonoValido=FormularioRepresentante.ValidacionTelefono();
      }
      //Control de DNI sin que aparezca el error de Telefono
      if (dniNumero !== "") {
        dniValido=FormularioRepresentante.ValidarDNI();
      }
      if (politicaValida && telefonoValido && dniValido) {
        FormularioRepresentante.HabilitarBoton();
      } else {
        FormularioRepresentante.DeshabilitarBoton();
      }
    },
    MensajeErrorDNI: function () {
      let div = $("#errorDNI");
      if (div != null && div.length === 0) {
        $("#mensajeAyuda").after(
          '<div id="errorDNI" class="alert alert-danger" role="alert">El NIF introducido no es correcto. Por favor, revisalo y vuelve a introducirlo.</div>'
        );
      }
    },
    MensajeErrorTelefono: function () {
      let div = $("#errorTelefono");
      if (div != null && div.length === 0) {
        $("#mensajeAyuda").after(
          '<div id="errorTelefono" class="alert alert-danger" role="alert">El numero de teléfono introducido no es correcto. Por favor, revisalo y vuelve a introducirlo.</div>'
        );
      }
    },
    EliminarDivError: function (idDiv) {
      $(idDiv).remove();
    },
  }; 
</script>